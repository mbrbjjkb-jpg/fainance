<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>投資信託ポートフォリオ計算ツール</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  textarea { width: 100%; height: 80px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  button { margin: 5px; }
  #summary { margin-top: 20px; font-weight: bold; white-space: pre-line; }
</style>
</head>
<body>
<h2>投資信託ポートフォリオ計算ツール</h2>
<textarea id="inputText" placeholder="ここに全銘柄情報を貼り付け"></textarea>
<button onclick="parseAllStocks()">全銘柄解析・計算</button>
<table id="stockTable">
  <thead>
    <tr>
      <th>銘柄名</th>
      <th>購入価格</th>
      <th>保有数</th>
      <th>時価</th>
      <th>損益</th>
      <th>NISA</th>
      <th>投資期間</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<div id="summary" tabindex="0"></div>
<script>
const stocks = [];

function parseNumber(text) {
  return parseFloat(text.replace(/[,+%\s]/g,''));
}

function calculatePeriod(start, end) {
  const startDate = new Date(start);
  const endDate = end ? new Date(end) : new Date();
  let years = endDate.getFullYear() - startDate.getFullYear();
  let months = endDate.getMonth() - startDate.getMonth();
  if(months < 0) { years -=1; months += 12; }
  return `${startDate.getFullYear()}/${('0'+(startDate.getMonth()+1)).slice(-2)}〜${end ? (endDate.getFullYear()+'/'+('0'+(endDate.getMonth()+1)).slice(-2)) : '現在まで'}（${years}年${months}か月）`;
}

function parseAllStocks() {
  stocks.length = 0;
  const inputField = document.getElementById('inputText');
  const text = inputField.value;
  const blocks = text.split(/\n(?=チャート画像)/);

  blocks.forEach(block => {
    const nameMatch = block.match(/投信\s*\n?(.*)/);
    if(!nameMatch) return;
    let name = nameMatch[1].trim();
    const purchaseMatch = block.match(/購入価格\s*\n?([0-9,\.]+)/);
    const unitsMatch = block.match(/保有数\s*\n?([0-9,\.]+)/);
    const marketMatch = block.match(/時価\s*\n?([0-9,\.]+)/);
    const profitMatch = block.match(/損益\s*\n?([\+\-0-9,\.]+)/);
    if(!purchaseMatch || !unitsMatch || !marketMatch || !profitMatch) return;

    const purchasePrice = parseNumber(purchaseMatch[1]);
    const units = parseNumber(unitsMatch[1]);
    const marketValue = parseNumber(marketMatch[1]);
    const profit = parseNumber(profitMatch[1]);

    let isNISA = false;
    let periodStart = null;
    let periodEnd = null;

    if(name.includes('楽天・全米株式インデックス･ファンド') && units === 23.5) {
      name = '楽天・全米株式インデックス･ファンド（新NISA）';
      isNISA = true;
      periodStart = '2024-01-01';
    }
    if(name.includes('楽天・全米株式インデックス･ファンド') && units === 53.2) {
      name = '楽天・全米株式インデックス･ファンド（旧NISA）';
      isNISA = true;
      periodStart = '2021-05-01';
      periodEnd = '2023-12-31';
    }
    if(name.includes('セゾン･グローバルバランスファンド')) {
      periodStart = '2017-05-01';
    }
    if(name.includes('ひふみ投信')) {
      periodStart = '2016-06-01';
    }
    if(name.includes('iシェアーズ 米国株式')) {
      periodStart = '2017-05-01';
      periodEnd = '2021-04-30';
    }

    const profitPercent = ((profit / (purchasePrice * units)) * 100).toFixed(2);
    const period = periodStart ? calculatePeriod(periodStart, periodEnd) : '不明';

    stocks.push({name, purchasePrice, units, marketValue, profit, profitPercent, isNISA, period});
  });

  // 入力フォームをクリア
  document.getElementById('inputText').value = '';

  renderTable();
  calculateTotal();
  document.getElementById('summary').focus();
}

function renderTable() {
  const tbody = document.querySelector('#stockTable tbody');
  tbody.innerHTML = '';
  for(const s of stocks) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.name}</td><td>${s.purchasePrice.toLocaleString()}円</td><td>${s.units}</td><td>${s.marketValue.toLocaleString()}円</td><td>${s.profit.toLocaleString()}円 (+${s.profitPercent}%)</td><td>${s.isNISA ? 'NISA':'課税'}</td><td>${s.period}</td>`;
    tbody.appendChild(tr);
  }
}

function calculateTotal() {
  let totalMarket = 0;
  let totalPurchase = 0;
  let totalProfit = 0;
  let taxableProfit = 0;
  let nisaProfit = 0;
  const TAX_RATE = 0.2;

  for(const s of stocks) {
    totalMarket += s.marketValue;
    totalPurchase += s.purchasePrice * s.units;
    totalProfit += s.profit;
    if(s.isNISA) nisaProfit += s.profit;
    else taxableProfit += s.profit;
  }

  const tax = Math.round(taxableProfit * TAX_RATE);
  const afterTaxProfit = Math.round(totalProfit - tax);
  const afterTaxMarket = Math.round(totalMarket - tax);
  const totalProfitPercent = ((totalProfit / totalPurchase) * 100).toFixed(2);

  const summaryDiv = document.getElementById('summary');
  summaryDiv.innerText =
    `合計時価: ${Math.round(totalMarket).toLocaleString()}円（ 総損益: ${Math.round(totalProfit).toLocaleString()}円 (+${totalProfitPercent}%) ＋購入価格: ${Math.round(totalPurchase).toLocaleString()}円）\n\n` +
    `課税対象利益: ${Math.round(taxableProfit).toLocaleString()}円\n` +
    `(想定税額20%: ${tax.toLocaleString()}円）\n` +
    `※NISA利益(非課税): ${Math.round(nisaProfit).toLocaleString()}円\n` +
    `税引き利益: ${afterTaxProfit.toLocaleString()}円\n\n` +
    `税引き後合計時価: ${afterTaxMarket.toLocaleString()}円`;
}
</script>
</body>
</html>




投資信託シミュレーションまとめ
前提条件

投資開始・積立額
| 期間 | 月額 | 備考 |
|------|------|------|
| 2016/6 ～ 2021/3 | 70,000円 | 通常口座 |
| 2021/4 ～ 現在 | 73,000円 | NISA 33,000円 + 通常口座 40,000円 |

現在の口座実績（2025年想定）

総入金：7,967,223円

評価損益：7,950,658円

合計評価額：15,917,881円

利率・税金

過去実績ベースの正確な内部収益率（IRR）：

月利 ≈ 1.1178%

年利 ≈ 14.27%（毎月積立を考慮した複利利率）

税率：通常口座 20.315%（NISAは非課税）

7年間積立後の評価額（2032年想定）
年利	税引後総額	累計入金	税引後利益
5%	27,299,298円	14,099,223円	13,200,075円
7.7%	31,612,284円	14,099,223円	17,513,061円
14.27%	45,034,585円	14,099,223円	30,935,362円

ポイント：IRRベースで計算すると、単純計算（総額2倍など）より正確に利回りが出る。

25年間取り崩しシミュレーション

取り崩し条件：

53歳から開始（2032年に積立完了→60歳から取り崩し）

毎月 150,000円

税金：取り崩し時の課税は概算で20〜30%

期間：25年（300か月）

年率別25年後結果
年率	税引後総資産（7年後）	25年後残高	累計取り崩し額	コメント
5%	27,299,298円	0円	29,800,000円	低利率ではどちらも資産底を尽くす
7.7%	31,612,284円	≈2,100,000円	45,900,000円	安全マージンあり
14.27%	45,034,585円	21,500,000円	93,500,000円	高利回りでは取り崩しても資産増加
課税タイミングの影響（税率30%想定）
年率	一括20%課税後取り崩し	25年後残高	毎月取り崩し30%課税	25年後残高	コメント
5%	21,839,438円	0	税30%で計算	0	低利率では差なし
7.7%	25,289,827円	0.1M	税30%で計算	1.1M	毎月課税の方が残高多め
14.27%	36,027,668円	10.5M	税30%で計算	21.5M	高利回りでは毎月課税の方が有利

結論

高利回りの場合、口座に残して毎月取り崩す方が税効率が良い

低利回りでは一括課税でも差はほぼ無視できる

まとめポイント

IRR（月次複利）を使うと利回り計算が正確になる

単純に総入金と現在評価額から年利を出すと、積立タイミングの効果を無視して大きくブレる

7年間積立後の資産額

低利率では安全マージンが少ない

高利率では余裕があるので取り崩し戦略を調整できる

取り崩し戦略

高利回り資産は「毎月取り崩し」の方が複利効果を活かせる

課税タイミングによって25年後の残高が大きく変わる

シナリオ作成

年率別シミュレーション、課税率変化も含めたキャッシュフロー表・グラフ化が可能

将来の利回り・税制変更を想定した複数シナリオ作成が重要


